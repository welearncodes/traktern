<?php 

//response generation function

$response = "";

//function to generate response
function my_contact_form_generate_response($type, $message) {

    global $response;

    if ($type == "success") $response = "<div class='success'>{$message}</div>";
    else $response = "<div class='error'>{$message}</div>";

}

//response messages
$not_human = "Human verification incorrect.";
$missing_content = "Please supply all information.";
$email_invalid = "Email Address Invalid.";
$message_unsent = "Message was not sent. Try Again.";
$message_sent = "Thanks! Your message has been sent.";

//user posted variables
$name = $_POST['message_name'];
$email = $_POST['message_email'];
$message = $_POST['message_text'];
$human = $_POST['message_human'];

//php mailer variables
$to = get_option('admin_email');
$subject = "Someone sent a message from ".get_bloginfo('name');
$headers = 'From: '.$email."\r\n".'Reply-To: '.$email."\r\n";

if (!$human == 0) {
    if ($human != 2) my_contact_form_generate_response("error", $not_human); //not human!
    else {

        //validate email
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) my_contact_form_generate_response("error", $email_invalid);
        else //email is valid
        {
            //validate presence of name and message
            if (empty($name) || empty($message)) {
                my_contact_form_generate_response("error", $missing_content);
            } else //ready to go!
            {
                $sent = wp_mail($to, $subject, strip_tags($message), $headers);
                if ($sent) my_contact_form_generate_response("success", $message_sent); //message sent!
                else my_contact_form_generate_response("error", $message_unsent); //message wasn't sent
            }
        }
    }
} else if ($_POST['submitted']) my_contact_form_generate_response("error", $missing_content);

?> 



                <style type="text/css">
                .error {
                        padding: 5px 9px;
                        border: 1px solid red;
                        color: red;
                        border-radius: 3px;
                    }
                    
                    .success {
                        padding: 5px 9px;
                        border: 1px solid green;
                        color: green;
                        border-radius: 3px;
                    }
                
                </style>

                <div id="respond">
                    <?php echo $response; ?>
                

                <div class="et_pb_column et_pb_column_4_4  et_pb_column_2">


                    <div id="et_pb_contact_form_2" class="et_pb_module et_pb_contact_form_container clearfix  et_pb_contact_form_2" data-form_unique_num="2">


                        <div class="et-pb-contact-message">Det er for tiden ingen annonserte stillinger, men legg gjerne igjen CV og kontaktinformasjon i skjemaet under så tar vi kontakt.</div>

                        <div class="et_pb_contact">
                            <form class="et_pb_contact_form clearfix" method="post" action="<?php the_permalink(); ?>" _lpchecked="1">

                                <p class="et_pb_contact_field et_pb_contact_field_0 et_pb_contact_field_half">
                                    <label for="et_pb_contact_navn_2" class="et_pb_contact_form_label">Navn</label>
                                    <input type="text" id="et_pb_contact_navn_2" class="input" value="Navn" name="et_pb_contact_navn_2" data-required_mark="required" data-field_type="input" data-original_id="cv_navn">
                                </p>
                                <p class="et_pb_contact_field et_pb_contact_field_1 et_pb_contact_field_half et_pb_contact_field_last">
                                    <label for="et_pb_contact_e-post_2" class="et_pb_contact_form_label">E-postadresse</label>
                                    <input type="text" id="et_pb_contact_e-post_2" class="input" value="<?php echo esc_attr($_POST['message_name']); ?>" name="et_pb_contact_e-post_2 " data-required_mark="required " data-field_type="email " data-original_id="cv_e-post ">
                                </p>
                                <p class="et_pb_contact_field et_pb_contact_field_2 et_pb_contact_field_last ">
                                    <label for="et_pb_contact_melding_2 " class="et_pb_contact_form_label ">Kort om deg selv</label>
                                    <textarea name="et_pb_contact_melding_2 " id="et_pb_contact_melding_2 " value=" " class="et_pb_contact_message input " data-required_mark="required " data-field_type="text " data-original_id="cv_melding ">Melding</textarea>
                                </p>
                                <p class="et_pb_contact_field et_pb_contact_field_2 et_pb_contact_field_last ">
                                    <label for="et_pb_contact_cv_2 " class="et_pb_contact_form_label ">Last opp CV</label>
                                    <input type="file " id="cv " name="cv " class="input " accept="application/pfd,application/msword,text/plain ">
                                </p>
                                <input type="hidden " value="<?php echo esc_attr($_POST['message_name']); ?> " " name="et_pb_contactform_submit_0 ">
                                    <input type="text " value="<?php echo esc_attr($_POST['message_name']); ?> " " name="et_pb_contactform_validate_0 " class="et_pb_contactform_validate_field ">
                                <p>
                                    <label for="message_human ">Human Verification: <span>*</span>
                                        <br>
                                        <input type="text " style="width: 60px; " name="message_human "> + 3 = 5</label>
                                </p>

                                <div class="et_contact_bottom_container ">

                                    <button type="submit " class="et_pb_contact_submit et_pb_button et_pb_custom_button_icon " data-icon=" ">Send</button>
                                </div>
                                <input type="hidden " id="_wpnonce-et-pb-contact-form-submitted_cv " name="_wpnonce-et-pb-contact-form-submitted " value="<?php echo esc_attr($_POST['message_name']); ?> " ">
                                    <input type="hidden " name="_wp_http_referer " value="<?php echo esc_attr($_POST['message_name']); ?> " ">
                            </form>
                        </div>
                    </div>
                </div>
